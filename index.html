<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authority | Encrypted Bridge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background-color: #000; color: #fff; font-family: 'Inter', sans-serif; overflow: hidden; user-select: none; }
        .firewall-card { background: #050505; border: 1px solid #111; border-radius: 2rem; position: relative; }
        .packet-stream { height: 80px; overflow: hidden; position: relative; background: #080808; border-radius: 12px; border: 1px solid #1a1a1a; }
        .packet-line { position: absolute; width: 100%; color: #2563eb; font-family: monospace; font-size: 7px; animation: move-up 2.5s linear infinite; }
        @keyframes move-up { 0% { transform: translateY(80px); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { transform: translateY(-20px); opacity: 0; } }
        .bridge-scan { position: absolute; top: 0; width: 100%; height: 2px; background: #3b82f6; box-shadow: 0 0 15px #3b82f6; animation: scan 4s infinite linear; }
        @keyframes scan { 0% { top: 0; } 100% { top: 100%; } }
        .shake { animation: shake 0.4s; border-color: #ef4444 !important; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
    </style>
</head>
<body>

    <div id="bridge-overlay" class="fixed inset-0 z-[9999] bg-black flex items-center justify-center p-4">
        <div id="main-card" class="firewall-card max-w-sm w-full p-8 overflow-hidden border border-white/5">
            <div class="bridge-scan"></div>
            
            <div class="text-center mb-6">
                <i class="fas fa-microchip text-2xl text-blue-600 mb-2"></i>
                <h1 class="text-[9px] font-black uppercase tracking-[0.4em]">Encrypted Layer Firewall</h1>
                <p id="status-msg" class="text-[7px] text-zinc-600 uppercase mt-1 tracking-widest font-bold">Checking Environment Integrity...</p>
            </div>

            <div id="packet-console" class="packet-stream mb-6 p-2">
                <div id="stream-content"></div>
            </div>

            <div id="auth-layers" class="hidden space-y-4">
                <div class="flex items-center justify-between p-4 bg-zinc-900/40 rounded-2xl border border-white/5">
                    <div class="flex items-center gap-3">
                        <input type="checkbox" id="robot-check" class="w-4 h-4 rounded accent-blue-600 cursor-pointer">
                        <span class="text-[9px] font-bold text-zinc-400 uppercase tracking-widest">Human Handshake</span>
                    </div>
                </div>

                <div id="challenge-layer" class="hidden space-y-3">
                    <div id="captcha-display" class="py-4 text-center rounded-xl bg-zinc-900 border border-white/5 text-lg font-black tracking-[8px] text-blue-500 italic"></div>
                    <input type="text" id="captcha-input" maxlength="6" autocomplete="off" placeholder="SECRET KEY" 
                           class="w-full bg-zinc-900 border border-white/10 rounded-xl p-3 text-center text-xs font-black outline-none focus:border-blue-600 uppercase tracking-widest">
                </div>

                <button id="bridge-btn" class="w-full py-4 bg-blue-600 text-white rounded-2xl text-[10px] font-black uppercase tracking-[0.2em] shadow-lg shadow-blue-900/20 active:scale-95 transition-all">
                    Establish Bridge
                </button>
            </div>

            <div class="mt-6 flex justify-between text-[6px] font-bold text-zinc-700 uppercase">
                <span>Status: <span id="meta-node" class="text-zinc-500">Scanning...</span></span>
                <span>ID: <span id="meta-id">---</span></span>
            </div>
        </div>
    </div>

    <script type="module">
        import { db } from 'https://patel-102.github.io/Fantasy/firebase.js';
        import { collection, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js';

        // --- ðŸ” ENCRYPTED PAYLOAD DATA (Base64) ---
        const _0xPayload = {
            tkn: "YTI2N2U0MzQwYzM0YmQ=", // Your IPinfo Token
            tgt: "bG9naW4uaHRtbA==",     // login.html
            msg_1: "RVJST1I6IFZJUlRVQUxfTUFDSElORV9ERVRFQ1RERA==", // VM Detected
            msg_2: "RVJST1I6IE5FVFdPUktfTUFTS0lOR19CTE9DS0VE"      // VPN Detected
        };
        const decrypt = (str) => atob(str);

        const bridgeBtn = document.getElementById('bridge-btn');
        const robotCheck = document.getElementById('robot-check');
        const captchaInput = document.getElementById('captcha-input');
        const card = document.getElementById('main-card');
        const stream = document.getElementById('stream-content');

        let bridgeSecret = "";
        let isSystemClean = true;

        // --- ðŸ•µï¸ ADVANCED DETECTION: Environment Integrity ---
        function runIntegrityScan() {
            // Detect if screen is too small or browser is being controlled by automation
            if (window.outerWidth === 0 || window.outerHeight === 0 || navigator.webdriver) {
                isSystemClean = false;
                document.getElementById('status-msg').innerText = decrypt(_0xPayload.msg_1);
            }
            
            const logs = [
                "INITIATING_CORE_SCAN...", "OBFUSCATING_PAYLOADS...", "CHECKING_WEBDRIVER_FLAGS...",
                "VERIFYING_HARDWARE_ACCEL...", "FETCHING_NETWORK_INTEL...", "DECRYPTING_BRIDGE_KEY..."
            ];

            logs.forEach((text, i) => {
                setTimeout(() => {
                    const p = document.createElement('div');
                    p.className = 'packet-line';
                    p.style.top = (i * 12) + 'px';
                    p.innerText = `>> ${text}`;
                    stream.appendChild(p);
                    if(i === logs.length -1) finalizeBridge();
                }, i * 350);
            });
        }

        async function finalizeBridge() {
            if (!isSystemClean) return;
            try {
                const res = await fetch(`https://ipinfo.io/json?token=${decrypt(_0xPayload.tkn)}`);
                const data = await res.json();
                
                const blocked = data.privacy?.vpn || data.privacy?.proxy || data.privacy?.hosting || data.country !== "IN";

                if (blocked) {
                    document.getElementById('status-msg').innerText = decrypt(_0xPayload.msg_2);
                    document.getElementById('status-msg').style.color = "#ef4444";
                } else {
                    document.getElementById('meta-id').innerText = data.ip;
                    document.getElementById('meta-node').innerText = "India (Residential)";
                    document.getElementById('status-msg').innerText = "INTEGRITY CLEAR: READY";
                    document.getElementById('auth-layers').classList.remove('hidden');
                }
            } catch (e) {
                document.getElementById('status-msg').innerText = "CRYPTO_HANDSHAKE_FAILED";
            }
        }

        window.genSecret = () => {
            bridgeSecret = Math.random().toString(36).substring(2, 8).toUpperCase();
            document.getElementById('captcha-display').innerText = bridgeSecret;
        };

        robotCheck.onchange = (e) => {
            if (e.target.checked) {
                document.getElementById('challenge-layer').classList.remove('hidden');
                genSecret();
            } else {
                document.getElementById('challenge-layer').classList.add('hidden');
            }
        };

        bridgeBtn.onclick = async () => {
            const userCode = captchaInput.value.toUpperCase();

            if (!robotCheck.checked || userCode !== bridgeSecret || userCode === "") {
                card.classList.add('shake');
                setTimeout(() => card.classList.remove('shake'), 400);
                if(robotCheck.checked) genSecret();
                captchaInput.value = "";
                return;
            }

            bridgeBtn.innerText = "BRIDGE_OPEN";
            bridgeBtn.style.background = "#059669";

            await addDoc(collection(db, "security_logs"), {
                ip: document.getElementById('meta-id').innerText,
                type: "ENCRYPTED_BRIDGE_AUTH",
                timestamp: serverTimestamp()
            });

            setTimeout(() => { window.location.href = decrypt(_0xPayload.tgt); }, 1000);
        };

        runIntegrityScan();
    </script>
</body>
</html>
